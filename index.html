<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Renewables M&A Transactions</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.2.1/css/fixedHeader.dataTables.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent double scrollbars */
            height: 100vh; /* Full viewport height */
        }

        .table-container {
            width: 100%; /* Allow the table container to stretch to full width */
            height: calc(100vh - 80px); /* Subtract the header height (adjust 80px as needed) */
            overflow: hidden; /* Prevent scrollbars in the container */
        }

        #loadingIndicator {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            background-color: #fff;
            border: 1px solid #ccc;
            display: none;
            z-index: 1000;
        }

        .summary-column {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        th.summary-column, td.summary-column {
            width: 200px;
            max-width: 200px;
        }

        td.details {
            padding: 0;
            background-color: #f9f9f9;
        }

        .details-content {
            padding: 10px;
        }

        #dataTable tbody tr {
            cursor: pointer;
        }

        .dataTables_scrollBody {
            overflow: auto !important; /* Ensure only the table body scrolls */
        }

        .dataTables_wrapper .dataTables_scrollHead {
            overflow: visible;
            position: sticky;
            top: 0;
            z-index: 2;
        }

        h1 a {
            text-decoration: none; /* Remove underline */
            color: inherit; /* Use the same color as the header text */
        }

        #entriesInfo {
            margin: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Section 1: Index Part -->
    <h1><a href="javascript:location.reload()">Renewables M&A Transactions</a></h1>
    <div id="entriesInfo">Showing 0 out of 0 entries</div>
    <!-- Loading Indicator -->
    <div id="loadingIndicator">Loading...</div>
    <div class="table-container">
        <table id="dataTable" class="display" style="width:100%">
            <thead>
                <tr>
                    <!-- Column headers will be dynamically generated -->
                </tr>
            </thead>
            <tbody>
                <!-- Data will be dynamically loaded -->
            </tbody>
        </table>
    </div>

    <!-- Section 2: Script Part -->
    <!-- jQuery Library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.2.1/js/dataTables.fixedHeader.min.js"></script>
    <script>
        $(document).ready(function () {
            const columnOrder = ['date', 'buyer', 'seller', 'target', 'technology_type', 'capacity', 'acquisition_price', 'stake_percentage', 'url', "entry_added", "entry_last_updated"];

            function updateEntriesInfo(total) {
                $('#entriesInfo').text(`Showing ${total} entries`);
            }

            function initializeDataTable(data) {
                const table = $('#dataTable').DataTable({
                    columns: columnOrder.map(col => {
                        if (col === 'url') {
                            return {
                                title: col.replace(/_/g, ' ').toUpperCase(),
                                data: col,
                                render: (data, type) => type === 'display' ? `<a href="${data}" target="_blank">URL</a>` : data
                            };
                        } else {
                            return {
                                title: col.replace(/_/g, ' ').toUpperCase(),
                                data: col,
                                width: '150px'
                            };
                        }
                    }),
                    data: data,
                    scrollY: 'calc(100vh - 120px)',
                    scrollX: true,
                    paging: false,
                    info: false,
                    autoWidth: true,
                    ordering: true,
                    order: [[0, 'desc']],
                    searching: true,
                    scrollCollapse: true,
                    fixedHeader: true,
                    deferRender: true
                });
                updateEntriesInfo(data.length);
            }

            function loadCSVData() {
                fetch('data.csv')
                    .then(response => response.text())
                    .then(csvText => {
                        const rows = csvText.split('\n').filter(row => row.trim() !== '');
                        const headers = rows[0].split(',');
                        const data = rows.slice(1).map(row => {
                            const values = row.split(',');
                            return headers.reduce((obj, header, idx) => {
                                obj[header.trim()] = values[idx]?.trim() || '';
                                return obj;
                            }, {});
                        });

                        initializeDataTable(data);
                    })
                    .catch(error => {
                        console.error('Error loading CSV:', error);
                    });
            }

            loadCSVData();
        });
    </script>
</body>
</html>
